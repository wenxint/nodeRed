// cs protocol
syntax = "proto3";

package zonepb.pvppb.ladderyearpb;
option go_package = "git.code.oa.com/red/zonesvr/pkg/proto/zonepb/pvppb/ladderyearpb";


import "corepb/common.proto";

// 段位赛赛年系统
service LadderYearService {
  // 获取赛年信息
  rpc LadderYearInfo(LadderYearInfoRequest) returns (LadderYearInfoReply);
  // 领取进度奖励
  rpc ReceiveProgressReward(ReceiveProgressRewardRequest) returns (ReceiveProgressRewardReply);
  // 领取任务奖励
  rpc ReceiveTaskReward(ReceiveTaskRewardRequest) returns (ReceiveTaskRewardReply);
}

message LadderYearProfile {
  int64 id               = 1;  // 当前赛年ID
  string name            = 2;  // 当前赛年名称
  int64 start_time       = 3;  // 赛年开始时间(unix second)
  int64 end_time         = 4;  // 赛年结束时间(unix second)
  int64 current_season   = 5;  // 当前赛季
  repeated int64 seasons = 6;  // 包含的赛季ID列表
}

message ProgressRewardDetail {
  int64 progress               = 1;  // 进度
  bool received                = 2;  // 是否已经领取
  repeated corepb.Item rewards = 3;  // 奖励
}

message RewardProgressInfo {
  int64 point                                           = 1;  // 当前积分
  repeated ProgressRewardDetail progress_reward_details = 2;  // 进度奖励详情
}

message TaskDetail {
  int64 task_id                = 1;  // 任务ID
  int64 finished_count         = 2;  // 任务完成次数
  int64 rewarded_count         = 3;  // 任务已经领取奖励次数
  int64 max_count              = 4;  // 任务完成次数上限
  int64 progress               = 5;  // 任务完成进度
  int64 total_progress         = 6;  // 任务总进度
  repeated corepb.Item rewards = 7;  // 任务奖励
}

message SeasonTaskInfo {
  int64 season_id                  = 1;  // 赛季ID
  int64 point_got                  = 2;  // 本赛季已经获得的积分
  int64 point_limit                = 3;  // 本赛季积分上限
  repeated TaskDetail task_details = 4;  // 任务详情
}

message LadderYearInfoRequest {}

message LadderYearInfoReply {
  LadderYearProfile profile               = 1;  // 赛年简要信息
  RewardProgressInfo reward_progress_info = 2;  // 奖励进度信息
  repeated SeasonTaskInfo task_infos      = 3;  // 任务信息
  ReturningBlessInfo returning_bless_info = 4;  // 追回祝福信息
}

message BlesssTaskInfo {
  int64 task_id             = 1;  // 任务ID
  int64 retrieved_count     = 2;  // 已追回任务完成次数
  int64 max_retrieved_count = 3;  // 可追回任务完成次数
}

message SeasonBlessInfo {
  int64 season_id                           = 1;  // 赛季ID
  repeated BlesssTaskInfo blesss_task_infos = 2;  // 祝福任务信息
}

message ReturningBlessInfo {
  int64 act_id                                = 1;  // 活动ID
  int64 end_at                                = 2;  // 活动结束时间
  repeated SeasonBlessInfo season_bless_infos = 3;  // 赛季祝福信息
}

message ReceiveProgressRewardRequest {
  int64 ladder_year_id    = 1;  // 赛年ID
  repeated int64 progress = 2;  // 领取的进度(支持批量领取)
}

message ReceiveProgressRewardReply {
  RewardProgressInfo reward_progress_info = 1;  // 更新后的奖励进度信息
  repeated corepb.Item rewards            = 2;  // 实际领取的奖励结果
}

message ReceiveTaskRewardRequest {
  int64 ladder_year_id    = 1;  // 赛年ID
  int64 season_id         = 2;  // 赛季ID
  map<int64, int64> tasks = 3;  // 领取的任务奖励(任务ID->领取次数，允许一次请求领取多次奖励)
}

message ReceiveTaskRewardReply {
  SeasonTaskInfo task_info          = 1;  // 更新后的本赛季任务信息
  repeated corepb.Item rewards      = 2;  // 实际领取的奖励结果
  SeasonBlessInfo season_bless_info = 3;  // 赛季祝福信息
}