// cs protocol
syntax = "proto3";

package zonepb.willcrystalpb;
option go_package = "git.woa.com/red/zonesvr/pkg/proto/zonepb/willcrystalpb";

import "corepb/common.proto";
import "pkg/proto/zonepb/specialpackpb/specialpack.proto";

service CSService {
  // 获取赛季
  rpc GetSeasons(GetSeasonsRequest) returns (GetSeasonsReply);

  // 开启赛季
  rpc OpenSeason(OpenSeasonRequest) returns (OpenSeasonReply);

  // 获取赛季内水晶套装列表和水晶列表
  rpc GetCrystals(GetCrystalsRequest) returns (GetCrystalsReply);

  // 水晶强化
  rpc CrystalLevelUp(CrystalLevelUpRequest) returns (CrystalLevelUpReply);

  // 水晶批量激活（0-1级）
  rpc BatchCrystalLevelActive(BatchCrystalLevelActiveRequest) returns (BatchCrystalLevelActiveReply);

  // 水晶套装共鸣
  rpc CrystalSuitLevelUp(CrystalSuitLevelUpRequest) returns (CrystalSuitLevelUpReply);

  // 待分解水晶道具列表
  rpc GetCrystalDecomposeItemList(GetCrystalDecomposeItemListRequest) returns (GetCrystalDecomposeItemListReply);

  // 水晶道具分解
  rpc CrystalDecompose(CrystalDecomposeRequest) returns (CrystalDecomposeReply);

  // 购买水晶球道具
  rpc BuyCrystalBallItem(BuyCrystalBallItemRequest) returns (BuyCrystalBallItemReply);

  // 开启水晶球
  rpc OpenCrystalBall(OpenCrystalBallRequest) returns (OpenCrystalBallReply);
}

message GetSeasonsRequest {
  int64 season_id = 1;  // 要获取详细信息的赛季id
}
message GetSeasonsReply {
  bool is_current_season_new_open              = 1;  // 是否当前赛季首次激活
  int64 season_reward_item_count               = 2;  // 赠送的赛季礼品数量
  repeated Season seasons                      = 3;
  bool has_got_dust                            = 4;  // 是否已获得过粉尘
  int64 manual_opened_season_count             = 5;  // 已经手动开启赛季的个数
  repeated CrystalSuit crystal_suits           = 6;  // request 中指定 season_id 的水晶套装列表
  repeated Crystal crystals                    = 7;  // request 中指定 season_id 的水晶列表
  int64 crystal_upgrade_need_user_level_deduct = 8;  // 水晶升级所需玩家等级减少值(词条影响)

  int64 crystal_ball_open_count_limit  = 9;   // 水晶球开启次数上限
  int64 crystal_ball_buy_count_limit   = 10;  // 水晶球购买次数上限
  int64 manual_open_other_season_level = 11;  // 开启其他赛季需要当前赛季的总星级

  repeated Cost ball_buy_costs = 12;  // 购买次数对应的消耗

  repeated zonepb.specialpackpb.SpecialPack special_packs = 13;  // 所拥有的限时礼包
}

message Cost {
  int64 bought_count        = 1;  // 已购买次数
  repeated corepb.Item cost = 2;  // 消耗
}

message Season {
  int64 season_id            = 1;
  int64 max_level            = 2;  // 开启其他赛季需要的总星级
  int64 current_level        = 3;  // 当前星级
  bool is_current_season     = 4;  // 是否当前赛季
  bool can_open_other_season = 5;  // 是否有资格开启其他赛季
  bool is_open               = 6;  // 是否开启
  bool can_level_up          = 7;  // 下属水晶或套装是否可升级

  int64 crystal_ball_open_count = 8;  // 今日水晶球已开启次数
  int64 crystal_ball_buy_count  = 9;  // 本周已经购买的水晶球个数

  bool has_opened_other_season = 10;  // 是否已经开启过其他赛季
}

message OpenSeasonRequest {
  int64 season_id        = 1;  // 要开启的赛季
  int64 source_season_id = 2;  // 满星赛季
}

message OpenSeasonReply {
  Season season = 1;
}

message GetCrystalsRequest {
  int64 season_id = 1;
}

message GetCrystalsReply {
  repeated CrystalSuit crystal_suits = 1;  // 水晶套装列表
  repeated Crystal crystals          = 2;  // 水晶列表
}

message CrystalSuit {
  int64 crystal_suit_id = 1;  // 套装id
  int64 level           = 2;  // 当前星级
  // repeated corepb.Item next_level_need_items = 4;  // 下一级需要的道具情况
  bool can_level_up = 3;  // 是否可升级
}

message Crystal {
  int64 crystal_id  = 1;  // 水晶id
  int64 level       = 2;  // 当前等级
  bool can_level_up = 3;  // 是否可升级

  reserved 4, 5;
}

message CrystalLevelUpRequest {
  int64 crystal_id = 1;  // 水晶id
}

message CrystalLevelUpReply {
  Crystal crystal = 1;  // 强化后水晶信息
}

message BatchCrystalLevelActiveRequest {
  int64 season_id = 1;  // 赛季id
}

message BatchCrystalLevelActiveReply {
  repeated Crystal crystal = 1;  // 激活后水晶信息列表
}

message CrystalSuitLevelUpRequest {
  int64 crystal_suit_id = 1;  // 套装id
}

message CrystalSuitLevelUpReply {
  CrystalSuit crystal_suit = 1;  // 共鸣后水晶套装信息
  Season season            = 2;  // 共鸣后赛季信息
}

message GetCrystalDecomposeItemListRequest {}

message GetCrystalDecomposeItemListReply {
  repeated CrystalDecomposeItem items = 1;  // 待分解道具列表
}

message CrystalDecomposeItem {
  int64 crystal_id = 1;  // 水晶id
  int64 level      = 2;  // 水晶等级
  int64 item_id    = 3;  // 待分解的物品id
  int32 count      = 4;  // 物品数量
  // repeated corepb.Item produce_items = 4;  // 分解一个道具产生的道具列表
}

message CrystalDecomposeRequest {
  repeated CrystalDecompose items = 1;  // 要分解的道具
}

message CrystalDecompose {
  int64 crystal_id = 1;  // 水晶id
  int64 item_id    = 2;  // 待分解的物品id
  int32 count      = 3;  // 要分解的数量
}

message CrystalDecomposeReply {
  int64 item_count = 1;  // 分解后获得的粉尘数
}

message BuyCrystalBallItemRequest {
  int64 season_id = 1;
  int64 count     = 2;
}

message BuyCrystalBallItemReply {
  repeated corepb.Item awards = 1;  // 奖励
}

message OpenCrystalBallRequest {
  int64 season_id = 1;
  int64 count     = 2;  // 要开启的次数
}

message OpenCrystalBallReply {
  repeated CrystalItem crystal_items = 1;
}

message CrystalItem {
  int64 crystal_id         = 1;  // 水晶id
  corepb.Item crystal_item = 2;  // 水晶强化道具
  corepb.Item dust         = 3;  // 满级后自动转化为的粉尘道具
}