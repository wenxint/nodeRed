// cs protocol
syntax = "proto3";

package mfcn.gatepb;
option go_package = "git.woa.com/mfcn/gatesvr/pkg/proto/gatepb";

service GateService {
  // 重定向请求
  rpc Redirect(RedirectRequest) returns (RedirectResponse);
}

// 重定向请求，客户端收到重定向通知后，连向新地址后，需要发送此请求
message RedirectRequest {}
message RedirectResponse {}

message Meta {
  enum Type {
    None     = 0;
    Request  = 1;
    Response = 2;
    Notify   = 3;
  }
  string service_name         = 1;
  string method_name          = 2;
  Type message_type           = 3;  // 消息类型
  uint32 client_seq           = 4;  // 请求序号
  uint32 server_seq           = 5;  // 服务端发送序号
  int32 zone                  = 6;  // 小区ID
  int32 timeout               = 7;  // 超时时间
  int32 error_code            = 8;
  bytes error_message         = 9;
  map<string, bytes> metadata = 10;
  uint32 fragments            = 11;  // 数据分段信息，目前只使用了低8位，值大于0表示这是一个分片，1 表示第一个分片，2 表示第二个分片，以此类推，0xFF表示最后一个分片
}

message EventMessage {
  string message_type = 1;
  bytes body          = 2;
}

message KickoutNotify {
  int32 reason          = 1;
  string reason_message = 2;
}

message RedirectNotify {
  string redirect_to = 1;
}

enum Error {
  OK                         = 0;
  ErrSystem                  = 1020001;  // 通用系统错误
  ErrUnknownMethod           = 1020002;  // RPC方法未注册
  ErrUnavailable             = 1020003;  // 服务不可用
  ErrRequestTimeout          = 1020004;  // 请求超时
  ErrLoginAgain              = 1020005;  // 请重新登陆
  ErrRedirect                = 1020006;  // 重新登陆到redirect_to指定的地址
  ErrLoginElsewhere          = 1020007;  // 在其他地方登陆被踢出
  ErrProtocolRetry           = 1020008;  // 协议重试，暂时登陆使用
  ErrServerNotOpen           = 1020009;  // 服务器暂未开放，请稍后再试
  ErrClientSeqWindBack       = 1020010;  // 前台client_seq绕回,拒绝请求
  ErrServerSeqSkipTooMuch    = 1020011;  // notify包丢失的太多,踢掉客户端
  ErrRequestFrequencyTooFast = 1020012;  // 请求的频率太快
  ErrLoginRateLimited        = 1020013;  // 登录限流
  ErrRequestInProgress       = 1020014;  // 请求在处理中
}
