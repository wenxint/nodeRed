// cs protocol
syntax = "proto3";

package zonepb.sharepb;
option go_package = "git.woa.com/red/zonesvr/pkg/proto/zonepb/sharepb";

import "corepb/common.proto";
import "pkg/proto/zonepb/pvppb/ladderpb/ladder.proto";

// buf:lint:ignore ENUM_ZERO_VALUE_SUFFIX
// enum ShareType {
//   UNKNOWN          = 0;  // 未知类型
//   FC               = 1;  // 战力分享
//   DUEL             = 2;  // 决斗场分享
//   RECRUIT_DRAW     = 3;  // 招募结果分享
//   NEW_BUDDY        = 4;  // 新增伙伴分享
//   RECRUIT_POSTER   = 5;  // 已有伙伴招募海报分享
//   RECRUIT_VIDEO    = 6;  // 已有伙伴招募视频分享
//   BATTLEPASS       = 7;  // BattlePass分享
//   FIGHT_SETTLEMENT = 8;  // PK结算分享
//   SCREENSHOT       = 9;  // 截图分享
// }

service CSService {
  // 个人分享信息
  rpc GetShareInfo(GetShareInfoRequest) returns (GetShareInfoReply);
  // 填充分享数据
  rpc FillShareData(FillShareDataRequest) returns (FillShareDataReply);
  // 上报分享
  rpc ReportShare(ReportShareRequest) returns (ReportShareReply);
  // share ark
  rpc ShareArk(ShareArkRequest) returns (ShareArkReply);
  // 上报实力达到一定数值的弹窗
  rpc ReportFCMilestonePopup(ReportFCMilestonePopupRequest) returns (ReportFCMilestonePopupReply);
}

message GetShareInfoRequest {
  int64 share_id = 1;  // 分享id
}

message GetShareInfoReply {
  bool has_share_reward              = 1;  // 是否有分享奖励
  repeated corepb.Item share_rewards = 2;  // 分享奖励
}

message ReportShareRequest {
  int64 share_id = 1;  // 分享id
}

message ReportShareReply {}

message FillShareDataRequest {
  int64 share_id = 1;  // 分享id
}

message FillShareDataReply {
  FillShareData share_data = 1;  // 分享数据
}

message FillShareData {
  reserved 3, 4, 5, 6;
  oneof data {
    FCShareData fc_data                 = 1;  // 战力分享数据
    DudelShareData dudel_data           = 2;  // 决斗场分享数据
    BattlePassShareData battlepass_data = 7;  // BattlePass分享数据
  }
}

message FCShareData {
  int64 zone_rank                             = 1;  // 本服排名
  int64 warzone_rank                          = 2;  // 战区排名
  int64 global_rank                           = 3;  // 全区排名
  int64 buddy_num                             = 4;  // 已拥有伙伴数量
  map<int64, QualityBuddyItem> quality_buddys = 5;  // 各品质伙伴数量 key: 伙伴品质
}

message QualityBuddyItem {
  int64 own_num   = 1;  // 已拥有伙伴数量
  int64 limit_num = 2;  // 最大可拥有伙伴数量
}

message DudelShareData {
  int64 season_id                                            = 1;  // 当前赛季ID
  int64 zone_rank                                            = 2;  // 本服排名
  int64 warzone_rank                                         = 3;  // 战区排名
  int64 global_rank                                          = 4;  // 全区排名
  repeated zonepb.pvppb.ladderpb.BuddyWinning buddy_winnings = 5;  // 伙伴场次和胜场信息
  int64 score                                                = 6;  // 积分
  int64 fight_cnt                                            = 7;  // 总场次
  int64 win_cnt                                              = 8;  // 胜场次
}

message BattlePassShareData {
  int64 season_id                   = 1;  // 当前赛季ID
  int64 level                       = 2;  // 当前等级
  int64 reward_num                  = 3;  // 当前等级累计的奖励份数
  repeated corepb.Item show_rewards = 4;  // 展示的奖励列表
  int64 likes                       = 5;  // 点赞数
  int64 rank                        = 6;  // 排名
}

// 方便活动分享统一协议，加个notify
message ShareRewardNotify {
  repeated corepb.Item rewards = 1;  // 奖励列表
}

message ShareArkRequest {
  int64 ark_id         = 1;
  string static_params = 2;
}

message ShareArkReply {
  string signed_ark = 1;
}

message ReportFCMilestonePopupRequest {
  int64 fc = 1;  // 弹窗的实力，对应配置表配置的fc
}

message ReportFCMilestonePopupReply {}