// cs protocol
syntax = "proto3";

package zonepb.pvppb.friendduelpb;
option go_package = "git.code.oa.com/red/zonesvr/pkg/proto/zonepb/pvppb/friendduelpb";


import "corepb/common.proto";

service FriendDuelService {
  // 获取好友切磋简略信息
  rpc ProfileInfo(ProfileInfoRequest) returns (ProfileInfoReply);
  // 检查好友切磋模式开启
  rpc CheckFightMode(CheckFightModeRequest) returns (CheckFightModeReply);
  // 娱乐赛-邀请玩家切磋
  rpc InvitePvp(InvitePvpRequest) returns (InvitePvpReply);
  // 娱乐赛-取消邀请
  rpc CancelInvitePvp(CancelInvitePvpRequest) returns (CancelInvitePvpReply);
  // 娱乐赛-处理邀请请求
  rpc HandlePvpInvitation(HandlePvpInvitationRequest) returns (HandlePvpInvitationReply);
}

message PvpInvitationNTF {
  reserved 7;
  int64 from_gid       = 1;  // 邀请人GID
  string from_name     = 2;  // 邀请人名字
  int64 from_level     = 3;  // 邀请人等级
  string from_plat_pic = 4;  // 邀请人头像
  bool is_from_plat    = 5;  // 邀请人是否是平台好友
  FightMode mode       = 6;  // 切磋模式
  // corepb.DressInfo dress_info              = 7;  // 邀请人装扮信息
  corepb.PersonalDisplayInfo personal_info = 8;  // 邀请人显示信息
}

message RejectPvpInvitationNTF {
  int64 gid    = 1;  // 被邀请人GID
  string name  = 2;  // 被邀请人名字
  int64 reason = 3;  // 拒绝原因，对应 ClientErrorCode.xlsx 中的错误码
}

message AcceptPvpInvitationNTF {
  int64 gid   = 1;  // 被邀请人GID
  string name = 2;  // 被邀请人名字
}

enum FightMode {
  // buf:lint:ignore ENUM_ZERO_VALUE_SUFFIX
  CASUAL                = 0;  // 娱乐模式  没有房间，直接开战
  LADDER                = 1;  // 段位模式  创建房间，直接选人
  BAN_LADDER            = 2;  // 征召模式  创建房间，有ban
  FAST_DUEL             = 3;  // 极速单挑  没有房间，直接开战
  FC_SUPPRESSION_LADDER = 4;  // 直接选人，但是有战力压制
}

message ProfileInfoRequest {}

message ProfileInfoReply {
  map<int64, bool> open_fight_modes = 1;  // 模式开启状态(FightModel -> 是否开启)
}

message CheckFightModeRequest {
  int64 mode = 1;  // 切磋模式，使用枚举 FightMode
}

message CheckFightModeReply {}

// 发出邀请
message InvitePvpRequest {
  int64 gid           = 1;  // 被邀请人GID
  FightMode mode      = 2;  // 切磋模式
  bool is_plat_friend = 3;  // 是否是平台好友
}

message InvitePvpReply {}

// 邀请方取消邀请
message CancelInvitePvpRequest {}

message CancelInvitePvpReply {}

enum InviteOpt {
  // buf:lint:ignore ENUM_ZERO_VALUE_SUFFIX
  REJECT = 0;  // 拒绝
  ACCEPT = 1;  // 接受
}

message HandlePvpInvitationRequest {
  int64 gid           = 1;  // 邀请人GID
  int64 opt           = 2;  // 操作 0-拒绝 1-接受
  FightMode mode      = 3;  // 切磋模式
  bool is_plat_friend = 4;  // 是否是平台好友
  int64 reject_reason = 5;  // 如果选择拒绝，需要传入拒绝原因，对应 ClientErrorCode.xlsx 中的错误码
}

message HandlePvpInvitationReply {}
