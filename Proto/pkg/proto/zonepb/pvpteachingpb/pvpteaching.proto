// cs protocol
syntax = "proto3";

package zonepb.pvpteachingpb;
option go_package = "git.code.oa.com/red/zonesvr/pkg/proto/zonepb/pvpteachingpb";

import "corepb/common.proto";

service PvpTeachingService {
  // 获取教学信息
  rpc GetPvpTeaching(GetPvpTeachingRequest) returns (GetPvpTeachingReply);
  // 领取教学奖励
  rpc ReceiveReward(ReceiveRewardRequest) returns (ReceiveRewardReply);
  // 消除红点
  rpc RemoveRedPoint(RemoveRedPointRequest) returns (RemoveRedPointReply);
}

message GetPvpTeachingRequest {}

message GetPvpTeachingReply {
  repeated MechanicsInfo mechanics         = 1;  // 机制信息列表
  repeated TeachingReward teaching_rewards = 2;  // 教学奖励列表
  repeated BuddyTeachingInfo buddys        = 3;  // 伙伴教学列表
}

// 机制信息
message MechanicsInfo {
  int64 mechanics_id     = 1;  // 机制ID
  int64 pre_mechanics_id = 2;  // 前置机制ID
  int64 dungeon_id       = 3;  // 关卡ID
  bool finished          = 4;  // 是否已完成
  TeachingReward rewards = 5;  // 对应的奖励
}

// 教学奖励
message TeachingReward {
  int64 reward_id              = 1;  // 奖励ID
  int64 current_progress       = 2;  // 当前进度
  int64 total_progress         = 3;  // 总进度
  bool received                = 4;  // 是否已经领取
  repeated corepb.Item rewards = 5;  // 奖励
  string name                  = 6;  // 名称
}

// 伙伴教学信息
message BuddyTeachingInfo {
  int64 buddy_id                 = 1;  // 伙伴ID
  int64 dungeon_id               = 2;  // 关卡ID
  repeated int64 finished_skills = 3;  // 已完成的技巧ID
  bool locked                    = 4;  // true: 未解锁
  bool teach_flag                = 5;  // 是否展示教学红点
}

// 领取教学奖励请求
message ReceiveRewardRequest {
  repeated int64 reward_ids = 1;  // 奖励ID列表
}
message ReceiveRewardReply {
  repeated int64 reward_ids = 1;  // 奖励ID列表
}

// 机制教学 CommonGameStartRequest custom_data
message GameStartReqCustomDataMechanicsTeaching {
  int64 mechanics_id             = 1;  // 机制ID
  repeated int64 teach_graph_ids = 2;  // 教学流程图ID
}

// 机制教学 CommonGameEndRequest custom_data
message GameEndReqCustomDataMechanicsTeaching {
  int64 mechanics_id = 1;  // 机制ID
}

// 伙伴教学 CommonGameStartRequest custom_data
message GameStartReqCustomDataBuddyTeaching {
  int64 buddy_id                 = 1;  // 伙伴ID
  repeated int64 teach_graph_ids = 2;  // 教学流程图ID
  int64 current_skill_id         = 3;  //初始技巧ID
}

// 伙伴教学 CommonGameEndRequest custom_data
message GameEndReqCustomDataBuddyTeaching {
  int64 buddy_id       = 1;  // 伙伴ID
  repeated int64 skill = 2;  // 完成的技巧ID列表
}

// 移除红点
message RemoveRedPointRequest {
  enum Type {
    TYPE_UNKNOWN    = 0;  // 未知类型
    SYSTEM_OPEN     = 1;  // 消除系统开启红点
    BUDDY_TEACH_TAG = 2;  // 消除伙伴激活红点
  }

  Type type      = 1;  // 消除类型
  int64 buddy_id = 2;  // 伙伴ID
}

// RemoveRedPointReply
message RemoveRedPointReply {}