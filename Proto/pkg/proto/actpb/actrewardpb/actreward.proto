// cs protocol
syntax = "proto3";

package actpb.actrewardpb;
option go_package = "git.woa.com/red/actsvr/pkg/proto/actpb/actrewardpb";

import "corepb/common.proto";

service CSActRewardService {
  // 获取活动奖励简略信息
  rpc SheetProfile(SheetProfileRequest) returns (SheetProfileReply);
  // 获取活动奖励详细信息
  rpc Detail(DetailRequest) returns (DetailReply);
  // 领取活动奖励
  rpc ClaimReward(ClaimRewardRequest) returns (ClaimRewardReply);
}

message SheetProfileRequest {
  int64 act_id = 1;  // 活动ID
}

enum SheetType {
  SHEET_TYPE_UNKNOWN = 0;  // 未知
  TASK_REWARDS       = 1;  // 任务奖励
  RANK_REWARDS       = 2;  // 排行奖励
}

message Profile {
  int64 sheet_id       = 1;  // 页签ID
  SheetType sheet_type = 2;  // 页签类型
  string sheet_name    = 3;  // 名称
  int64 end_at         = 4;  // 页签结束时间(unix second)，如果没有配置结束时间，此处为 0
  bool already_end     = 5;  // 页签是否已结束，如果已经结束，任务进度不会再更新
  string desc          = 6;  // 页签描述
}

message SheetProfileReply {
  repeated Profile profiles = 1;  // 活动奖励简略信息
}

message TaskReward {
  int64 task_id                     = 1;  // 任务ID
  int64 progress_need               = 2;  // 进度需求
  int64 progress                    = 3;  // 当前进度
  bool unlocked                     = 4;  // 是否解锁
  bool achieved                     = 5;  // 是否达成
  bool claimed                      = 6;  // 是否已领取
  repeated corepb.Item rewards_view = 7;  // 奖励展示
  string desc                       = 8;  // 任务描述
  int64 unlock_at                   = 9;  // 若任务尚未解锁，解锁时间(unix second)
}

message RankReward {
  int64 task_id                     = 1;  // 任务ID
  int64 rank_need                   = 2;  // 排名需求
  repeated corepb.Item rewards_view = 3;  // 奖励展示
  bool achieved                     = 4;  // 是否达成
  string desc                       = 5;  // 任务描述
}

message DetailRequest {
  int64 act_id   = 1;  // 活动ID
  int64 sheet_id = 2;  // 页签ID
}

message Detail {
  repeated TaskReward task_rewards = 1;  // 任务奖励(和排行奖励互斥，只有一个有值)
  repeated RankReward rank_rewards = 2;  // 排行奖励(和任务奖励互斥，只有一个有值)
}

message DetailReply {
  Detail detail = 1;  // 活动奖励详细信息
}

message ClaimRewardRequest {
  int64 act_id   = 1;  // 活动ID
  int64 sheet_id = 2;  // 页签ID
  int64 task_id  = 3;  // 任务ID
}

message ClaimRewardReply {
  repeated corepb.Item rewards = 1;  // 奖励
  repeated int64 task_ids      = 2;  // 领取成功的任务ID
  Detail detail                = 3;  // 更新后的活动奖励详细信息
}
