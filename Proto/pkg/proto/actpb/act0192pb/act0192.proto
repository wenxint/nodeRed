
// cs protocol
syntax = "proto3";

package actpb.act0192pb;
option go_package = "git.woa.com/red/actsvr/pkg/proto/actpb/act0192pb";

import "corepb/fight_common.proto";
import "pkg/proto/actpb/commonpb/common.proto";
import "corepb/loadout_comm.proto";
import "corepb/common.proto";

enum QuestStatus {    // 通关情况
  TYPE_UNKNOWN  = 0;  // 占位
  NOT_START     = 1;  // 未开启
  CAN_CHALLENGE = 2;  // 可挑战
  COMPLETED     = 3;  // 已完成
}

enum StarNameType {
  STARNAME_TYPE_UNKNOWN = 0;  // 未知
  COMPLETE              = 1;  // 通关
  WORTH                 = 2;  // 货运价值
}

message ActGetDetailRequest {}

message ActGetDetailReply {
  repeated Quest quests       = 1;  // 关卡信息
  bool show_loadout_red_point = 2;  // 是否显示阵容红点
}

message Quest {
  int64 quest_id                              = 1;  // 关卡id
  QuestStatus status                          = 2;  // 关卡情况
  int64 open_at                               = 3;  // 开放时间（时间戳）
  map<int64, actpb.commonpb.Task> reward_info = 4;  // 星数 -> 奖励状态
  string quest_name                           = 5;  // 关卡名
  bool new                                    = 6;  // “新”标记
  int64 aides_bonus                           = 7;  // 助手加成

  StarNameType star_condition1 = 8;   // 三星条件1
  int64 star_condition_para1   = 9;   // 三星条件参数1
  string star_text1            = 10;  // 三星文本1
  StarNameType star_condition2 = 11;  // 三星条件2
  int64 star_condition_para2   = 12;  // 三星条件参数2
  string star_text2            = 13;  // 三星文本2
  StarNameType star_condition3 = 14;  // 三星条件3
  int64 star_condition_para3   = 15;  // 三星条件参数3
  string star_text3            = 16;  // 三星文本3
}

service CSAct0192Service {
  rpc GameStart(GameStartRequest) returns (GameStartReply);           // 开战
  rpc GameEnd(GameEndRequest) returns (GameEndReply);                 // 结算
  rpc LoadoutInfo(LoadoutInfoRequest) returns (LoadoutInfoReply);     // 获取阵容信息
  rpc ApplyLoadout(ApplyLoadoutRequest) returns (ApplyLoadoutReply);  // 设置阵容
  rpc TouchQuest(TouchQuestRequest) returns (TouchQuestReply);        // 点击关卡
}

message GameStartRequest {
  int64 quest_id = 1;  // 关卡 ID
}
message GameStartReply {
  corepb.GameStartMessage start_msg = 1;  // 通用战斗开始消息
  int64 buddy_bonus                 = 2;  // 伙伴加成
}

message GameEndRequest {
  int64 quest_id                = 1;  // 关卡 ID
  corepb.FightResultType result = 2;  // 战斗结果
  int32 reason                  = 3;  // 结算原因:EGameResultReason
  int64 cur_stars               = 4;  // 当前获取星数情况(按位存，三种情况，不大于7)
}
message GameEndReply {
  corepb.GameOverMessage over_message = 1;  // 通用战斗结算消息
  repeated corepb.Item awards         = 2;  // 获得奖励
}

message LoadoutInfoRequest {
  int64 quest_id = 1;  // 关卡ID
}
message LoadoutInfoReply {
  corepb.LoadoutProfile profile = 1;  // 阵容配置
  corepb.Loadout loadout        = 2;  // 阵容
}

message ApplyLoadoutRequest {
  corepb.Loadout loadout = 1;  // 阵容
}
message ApplyLoadoutReply {}

message TouchQuestRequest {
  int64 quest_id = 1;  // 关卡 ID
}
message TouchQuestReply {}
