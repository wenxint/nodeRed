// cs protocol
syntax = "proto3";

package actpb.act0064pb;
option go_package = "git.woa.com/red/actsvr/pkg/proto/actpb/act0064pb";

import "pkg/proto/actpb/commonpb/common.proto";

// CSAct0064Service 小冯变变变活动服务
service CSAct0064Service {
  rpc GameStart(GameStartRequest) returns (GameStartReply);                             // 开战
  rpc GameEnd(GameEndRequest) returns (GameEndReply);                                   // 结算
  rpc DismissNewRedpoint(DismissNewRedpointRequest) returns (DismissNewRedpointReply);  // 消除新关卡红点
  rpc Like(LikeRequest) returns (LikeReply);                                            // 点赞
}

// ActGetDetailRequest 活动详情请求信息
message ActGetDetailRequest {}

// ActGetDetailReply 活动详情响应信息
message ActGetDetailReply {
  repeated LevelInfo levels          = 1;  // 关卡信息
  repeated actpb.commonpb.Task tasks = 2;  // 所有任务详细信息
  string rank_type                   = 3;  // 排行榜类型
  string rank_instance               = 4;  // 排行榜实例名
  LikeInfo like_info                 = 5;  // 点赞信息
  int64 infinite_level_score         = 6;  // 无限模式关卡分数
}

message LevelInfo {
  int64 id                  = 1;  // 关卡ID
  bool unlocked             = 2;  // 是否解锁
  bool passed               = 3;  // 是否通关
  bool is_infinite          = 4;  // 是否无限模式
  int64 open_at_unix_second = 5;  // 开启时间(unix second)
}

// GameStartRequest 开战请求
message GameStartRequest {
  int64 level_id = 1;
}

// GameStartReply 开战响应
message GameStartReply {}

// GameEndRequest 结算请求
message GameEndRequest {
  int64 level_id = 1;
  bool passed    = 2;
  int64 score    = 3;
}

// GameEndReply 结算响应
message GameEndReply {
  bool new_history_score    = 1;  // 是否分数新纪录
  repeated LevelInfo levels = 2;  // 更新后的关卡信息
}

message DismissNewRedpointRequest {}

message DismissNewRedpointReply {}

message LikeRequest {
  int64 gid = 1;  // 点赞对象ID
}

message LikeReply {
  LikeInfo like_info = 1;
}

message LikeInfo {
  bool liked      = 1;  // 是否已点赞
  int64 liked_gid = 2;  // 点赞对象ID
}