// cs protocol
syntax = "proto3";

package guildpb.pharmacypb;

option go_package = "git.woa.com/red/guildsvr/pkg/proto/guildpb/pharmacypb";

import "corepb/common.proto";

// 同盟药房(全知之书)服务
service GuildPharmacyService {
  rpc Query(QueryRequest) returns (QueryReply);                          // 查询同盟药房信息
  rpc Donate(DonateRequest) returns (DonateReply);                       // 捐赠活跃度、道具或金币
  rpc AwardQuery(AwardQueryRequest) returns (AwardQueryReply);           // 奖励页面查询(等级奖励和同盟药房天赋奖励)
  rpc Award(AwardRequest) returns (AwardReply);                          // 领取同盟奖励(等级奖励和同盟药房天赋奖励)
  rpc BatchAward(BatchAwardRequest) returns (BatchAwardReply);           // 批量领取同盟奖励(等级奖励和同盟药房天赋奖励)
  rpc DailyRecord(DailyRecordRequest) returns (DailyRecordReply);        // 查询每日贡献记录
  rpc HistoryRecord(HistoryRecordRequest) returns (HistoryRecordReply);  // 查询历史记录
}

message QueryRequest {}

message QueryReply {
  TalentInfo talent           = 1;  // 当前天赋信息
  corepb.FightAttr total_attr = 2;  // 当前以获得的总天赋加成

  // 活跃度任务相关
  int64 active_member_count = 3;  // 今日已达成活跃进度的玩家数
  int64 my_active           = 4;  // 我的活跃度
  int64 need_active         = 5;  // 活跃度达到多少可完成任务
  int64 active_status       = 6;  // 今日活跃度任务完成状态 enum ActiveStatus

  // 捐赠相关
  int64 donate_member_count   = 7;   // 今日已捐赠玩家数
  int64 my_donate_exp         = 8;   // 我今天通过捐赠提供的进度
  int64 member_max_donate_exp = 9;   // 每日每个玩家捐赠的总进度限制
  int64 guild_max_donate_exp  = 10;  // 每日同盟捐赠的总进度限制
  int64 guild_today_exp       = 11;  // 同盟今日已捐赠进度

  // 药方研制成功的弹窗
  TalentInfo talent_popup = 12;  // 不为空，则需要弹框提醒玩家，此时只有level和attr字段有效
  bool award_redpoint     = 13;  // 奖励按钮是否显示红点
}

enum ActiveStatus {
  ACTIVE_STATUS_UNKNOWN    = 0;  // 0-未知
  ACTIVE_STATUS_NOT_ENOUGH = 1;  // 1-活跃度不足
  ACTIVE_STATUS_CANNOT     = 2;  // 2-活跃度已够，但受加入同盟时间限制，不能完成
  ACTIVE_STATUS_CAN        = 3;  // 3-可完成
  ACTIVE_STATUS_DONE       = 4;  // 4-已完成
}

// 一条天赋(药方信息)
message TalentInfo {
  int64 level           = 1;  // 等级
  int64 status          = 2;  // 当前状态，0-未解锁，1-研制中，2-已激活(研制完成)
  int64 cur_exp         = 3;  // 当前进度
  int64 max_exp         = 4;  // 总进度
  corepb.FightAttr attr = 5;  // 当前等级对应的属性加成
}

message DonateRequest {
  int64 type                     = 1;  // 0-活跃度 1-料理捐赠 2-金币捐赠
  int64 level                    = 2;  // 要捐赠的天赋等级，有可能捐赠的同时别人捐赠导致等级变化，所以这里带上给后台校验下
  repeated corepb.Item item_list = 3;  // 捐赠的道具或者金币列表，type为0时不需要填该字段
}
message DonateReply {
  int64 got_exp                    = 1;  // 此次捐赠获得的进度
  TalentInfo talent                = 2;  // 捐赠后最新的当前天赋信息
  repeated corepb.Item reward_list = 3;  // 获得的奖励列表
}

message AwardQueryRequest {}
message AwardQueryReply {
  repeated AwardInfo talent_list = 1;  // 天赋奖励信息
  repeated AwardInfo level_list  = 2;  // 同盟等级奖励信息
}

message AwardInfo {
  int64 level                      = 1;  // 等级
  int64 status                     = 2;  // 领取状态，0-不可领取，1-可领取，2-已领取
  int64 process                    = 3;  // 分子
  int64 max_process                = 4;  // 分母
  repeated corepb.Item reward_list = 5;  // 奖励列表
}
message AwardRequest {
  int64 type  = 1;  // 领取的奖励类型，0-同盟等级奖励，1-同盟药房天赋奖励
  int64 level = 2;  // 要领取奖励的等级(同盟等级或同盟药房天赋等级)
}
message AwardReply {
  repeated corepb.Item reward_list = 1;  // 获得的奖励列表
}

message BatchAwardRequest {
  int64 type  = 1;  // 领取的奖励类型，0-同盟等级奖励，1-同盟药房天赋奖励
  int64 level = 2;  // 要领取奖励的等级(同盟等级或同盟药房天赋等级)
}

message BatchAwardReply {
  repeated corepb.Item reward_list = 1;  // 获得的奖励列表
  repeated int64 awarded_levels    = 2;  // 本次领取的奖励的level列表
}

message DailyRecordRequest {
  int64 type = 1;  // 0-每日活跃 1-捐赠
}
message DailyRecordReply {
  repeated DailyRecordInfo info_list = 1;
}
message DailyRecordInfo {
  PlayerSimpleInfo player_info = 1;  // 玩家信息
  int64 type                   = 2;  // 0-活跃，1-料理捐赠，2-金币捐赠
  int64 data                   = 3;  // type=0时为活跃度，type=1时为料理份数，type=2时为金币数
  int64 exp                    = 4;  // 本次捐赠获得的进度
  int64 time                   = 5;  // 时间戳
}

message HistoryRecordRequest {}
message HistoryRecordReply {
  repeated HistoryRecordInfo info_list = 1;
}
message HistoryRecordInfo {
  PlayerSimpleInfo player_info = 1;  // 玩家信息
  int64 total_exp              = 2;  // 总贡献
  int64 daily_exp              = 3;  // 日常贡献
  int64 gold_exp               = 4;  // 金币和料理贡献之和（转测后改的，所以这个字段名就不改了）
}

// 玩家简要数据
message PlayerSimpleInfo {
  reserved 4;
  int64 gid   = 1;  // gid
  string name = 2;  // 玩家昵称
  int64 level = 3;  // 玩家等级
  // corepb.DressInfo dress                   = 4;  // 装扮信息（称号，头像框等）
  string plat_pic                          = 5;  // 头像框
  corepb.PersonalDisplayInfo personal_info = 6;  // 个人显示信息
}
